<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Google Heatmap Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html, body, #map { height: 100%; margin: 0; }
      .controls { position:absolute; z-index:10; top:10px; left:10px; background:#fff; padding:8px 10px; border-radius:8px; font:14px system-ui; box-shadow:0 4px 12px rgba(0,0,0,.15);}
      .controls button { margin-right:6px; }
    </style>
    <script>
      let map, heatmap;

      async function initMap() {
        // 1) Create map
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 37.7749, lng: -122.4194 }, // start center
          zoom: 12,
          mapTypeId: "roadmap",
        });

        // 2) Load data (choose A or B below)

        // A) Static demo points (array of LatLngs or {location, weight})
        // const points = [
        //   new google.maps.LatLng(37.7749, -122.4194),
        //   { location: new google.maps.LatLng(37.7694, -122.4862), weight: 2 },
        //   new google.maps.LatLng(37.8079, -122.4177),
        // ];

        // B) From your backend (expects [{lat,lng,level}])
        const res = await fetch("http://localhost:5000/api/trash");
        const raw = await res.json();
        const points = raw.map(s =>
          s.level != null
            ? { location: new google.maps.LatLng(s.lat, s.lng), weight: s.level + 1 } // weight 1..3
            : new google.maps.LatLng(s.lat, s.lng)
        );

        // 3) Create heatmap layer
        heatmap = new google.maps.visualization.HeatmapLayer({
          data: points,
          dissipating: true,     // true = radius scales with zoom (good for city-level)
          radius: 24,            // tweak for your zoom range (in pixels)
          opacity: 0.7,
        });
        heatmap.setMap(map);

        // Optional: fit map to your data
        if (points.length) {
          const bounds = new google.maps.LatLngBounds();
          points.forEach(p => bounds.extend(p.location || p));
          map.fitBounds(bounds);
        }
      }

      // UI controls
      function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }
      function changeGradient() {
        const gradient = [
          "rgba(0, 255, 255, 0)",
          "rgba(0, 255, 255, 1)",
          "rgba(0, 191, 255, 1)",
          "rgba(0, 127, 255, 1)",
          "rgba(0, 63, 255, 1)",
          "rgba(0, 0, 255, 1)",
          "rgba(0, 0, 223, 1)",
          "rgba(0, 0, 191, 1)",
          "rgba(0, 0, 159, 1)",
          "rgba(0, 0, 127, 1)",
          "rgba(63, 0, 91, 1)",
          "rgba(127, 0, 63, 1)",
          "rgba(191, 0, 31, 1)",
          "rgba(255, 0, 0, 1)",
        ];
        heatmap.set("gradient", heatmap.get("gradient") ? null : gradient);
      }
      function changeRadius() {
        heatmap.set("radius", heatmap.get("radius") ? null : 24);
      }
      function changeOpacity() {
        heatmap.set("opacity", heatmap.get("opacity") === 0.7 ? 0.4 : 0.7);
      }
    </script>
  </head>
  <body>
    <div class="controls">
      <button onclick="toggleHeatmap()">Toggle</button>
      <button onclick="changeGradient()">Gradient</button>
      <button onclick="changeRadius()">Radius</button>
      <button onclick="changeOpacity()">Opacity</button>
    </div>
    <div id="map"></div>

    <!-- Load Maps JS with the visualization library and your API key -->
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=visualization&callback=initMap">
    </script>
  </body>
</html>
